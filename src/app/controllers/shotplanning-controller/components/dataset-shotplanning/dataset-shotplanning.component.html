<div class="main contentWrapper clearfix">
  <div *ngIf="shotplan else loading">
    <!-- Flip shot -->
    <div class="contentBox clearfix">
      <h5>Flips the calculated blast direction.</h5>
      <p class="txtSmall">WARNING: this will delete all holes and rows!</p>
      <a class="btnBlock" href="#">Flip Shot</a>
    </div>
    <!-- Rows  -->
    <div class="contentBox noPadding clearfix">
      <div class="clearfix p10">
        <div class="rows clearfix">
          <div class="rowsLeft">Row</div>
          <div class="rowsRight">
            <a id="toggleRow" class="btnToggle" [ngClass]="{ up: showEndpoints }" (click)="showEndpoints = !showEndpoints" href="javascript:void(0);">
              <img src="/assets/images/BtnRoundArrow.png" alt="">
            </a>
          </div>
        </div>
        <p class="txtSmall">Please click on any
          <span>row</span> to
          <span>add new row(s)</span>
        </p>
        <div class="rowsWrapper clearfix">
          <div *ngFor="let item of shotplan.rows$ | async; let i = index;" [ngClass]="{ btnRows: true, activeHole: i === selectedRow }"
            (click)="selectRow(i)">
            <span>{{ (i == 0) ? 'A-B Line' : 'Row ' + i }}</span>
            <a class="delbtnRows" *ngIf="i != 0"></a>
          </div>
        </div>
      </div>
      <div *ngIf="showEndpoints">
        <tabset *ngIf="(shotplan.rows$ | async)[selectedRow]; let row else nothing" class="tabBox clearfix" [justified]="true">
          <tab customClass="tabHeading" (select)="selectEndpointOffsetTab('offset')">
            <ng-template tabHeading>
              <div class="holeTabs clearfix">
                <a [ngClass]="{tabLink: true, activeTab: (endpointOffsetTab === 'offset')}">
                  Offset
                </a>
              </div>
            </ng-template>
            <div *ngIf="(shotplan.rows$ | async)[selectedRow]; let row else nothing" class="tabBox clearfix">
              <div class="tabOuterCont clearfix">
                <p id="txtEndpoints" class="txtSmall">Use
                  <span>"Endpoints"</span> tab to move the reference line Azimuth based on true north:
                  <span>{{((row.rowUpdate$() | async).azimuth$ | async)}}Â°</span>
                </p>
              </div>
            </div>
          </tab>
          <tab (select)="selectEndpointOffsetTab('endpoint')">
            <ng-template tabHeading>
              <div class="holeTabs clearfix">
                <a [ngClass]="{tabLink: true, activeTab: (endpointOffsetTab === 'endpoint')}">
                  Endpoints
                </a>
              </div>
            </ng-template>
            <div *ngIf="(shotplan.rows$ | async)[selectedRow]; let row else nothing" class="tabBox clearfix">
              <div class="tabOuterCont clearfix">
                <div class="">
                  <a (click)="moveEndpoints(row)" class="btnBlock">Move End Points</a>
                </div>
              </div>
            </div>
          </tab>
        </tabset>
      </div>
      <form *ngIf="(shotplan.rows$ | async)[selectedRow]; let row else nothing" class="dvAddNewRow clearfix" [formGroup]="newRowForm">
        <div class="clearfix">
          <h5 class="fLeft">Add New Row</h5>
          <a class="drawNewRow" (click)="drawNewRow()">Draw new row</a>
        </div>
        <div class="clearfix pTop10">
          <div class="addHoleRow clearfix">
            <div class="addHoleCol fLeft">
              <label class="lblHole">Along shotline</label>
              <p class="m">
                <input type="number" class="txtInput2" formControlName="along">
              </p>
            </div>
            <div class="addHoleCol fRight">
              <label class="lblHole">Away from shotline</label>
              <p class="m">
                <input class="txtInput2" type="number" formControlName="away">
              </p>
            </div>
          </div>
          <div class="addHoleRow clearfix">
            <div class="addHoleCol fLeft">
              <button type="button" [disabled]="newRowForm.invalid" class="btnBlock" (click)="placeRow(row)">Place Row</button>
            </div>
            <div class="addHoleCol fRight">
              <button type="button" [disabled]="newRowForm.invalid" class="btnBlock" (click)="copyRow(row)">Copy Row</button>

            </div>
          </div>
        </div>
        <div class="dvStagger">
          <div class="clearfix">
            <h5 class="fLeft">Stagger new line?</h5>
            <label class="switch fRight">
              <input class="switchBtn" type="checkbox" checked formControlName="stagger">
              <span class="switchSlider round"></span>
            </label>
          </div>
          <p class="txtSmall">When selected, a new line will stagger its position along the A-B line.</p>
        </div>
      </form>
    </div>
    <div *ngIf="(shotplan.rows$ | async)[selectedRow]; let row; else nothing" class="contentBox noPadding clearfix">
      <div class="clearfix p10">
        <div class="rows clearfix">
          <div class="rowsLeft">Holes</div>
          <div class="rowsRight">
            <a id="toggleHole" class="btnToggle" href="javascript:void(0);">
              <img src="images/BtnRoundArrow.png" alt="">
            </a>
          </div>
        </div>
        <p class="txtSmall">Please select any
          <span>Hole</span> to
          <span>add new hole(s)</span>
        </p>
        <div class="holseWrapper clearfix">
          <div *ngFor="let hole of row.holes$ | async; let i = index;" [ngClass]="{btnHoles: true, activeHole: i === selectedHole}"
            (click)="selectHole(i)">
            <span class="txtHole">Hole {{i}}</span>
            <a class="delbtnHoles" href="#"></a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<ng-template #loading>
  <app-shotplanning-tool [dataset]="dataset"></app-shotplanning-tool>
</ng-template>

<ng-template #nothing>
  nothing
</ng-template>